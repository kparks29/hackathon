!function(){"use strict";function e(e,r){return function(t,n){var o=[],u={},a="";if(_.contains(e(t.lot.appliances),n))a="lot.appliance",o=t.lot.appliances;else if(_.contains(e(t.lot.features),n))a="lot.feature",o=t.lot.features;else for(var c=0;c<t.structures.length;c++)if(_.contains(e(t.structures[c].appliances),n))a="structure.appliance",o=t.structures[c].appliances,u={structureIndex:c};else if(_.contains(e(t.structures[c].features),n))a="structure.feature",o=t.structures[c].features,u={structureIndex:c};else for(var s=0;s<t.structures[c].rooms.length;s++)_.contains(e(t.structures[c].rooms[s].appliances),n)?(a="room.appliance",o=t.structures[c].rooms[s].appliances,u={structureIndex:c,roomIndex:s}):_.contains(e(t.structures[c].rooms[s].features),n)?(a="room.feature",o=t.structures[c].rooms[s].features,u={structureIndex:c,roomIndex:s}):a="not found";return u=angular.extend({},u,r(o,n)),{location:a,indexes:u,array:o,docId:n}}}function r(){return function(e){for(var r=[],t=0;t<e.length;t++)e[t].documents&&(r=r.concat(e[t].documents));return r}}function t(){return function(e,r){for(var t=0;t<e.length;t++){var n=e[t].documents.indexOf(r);if(-1!=n)return{arrayIndex:t,documentIndex:e[t].documents.indexOf(r)};console.log("document id not found")}}}function n(){return function(e,r,t){switch(r){case"lot.appliance":e.lot.appliances[t.arrayIndex].documents.splice(t.documentIndex,1);break;case"lot.feature":e.lot.features[t.arrayIndex].documents.splice(t.documentIndex,1);break;case"structure.appliance":e.structures[t.structureIndex].appliances[t.arrayIndex].documents.splice(t.documentIndex,1);break;case"structure.feature":e.structures[t.structureIndex].features[t.arrayIndex].documents.splice(t.documentIndex,1);break;case"room.appliance":e.structures[t.structureIndex].rooms[t.roomIndex].appliances[t.arrayIndex].documents.splice(t.documentIndex,1);break;case"room.feature":e.structures[t.structureIndex].rooms[t.roomIndex].features[t.arrayIndex].documents.splice(t.documentIndex,1);break;case"not found":console.log("not in json");break;default:console.log("error")}return{address:e.address,images:e.images,lot:e.lot,structures:e.structures}}}function o(e,r){return function(t,n){return{md5:e.getMD5(t),file:t,headers:_.extend(e.getVersionUpdateHeaders(t,n),{"X-FILE-UUID":r()})}}}e.$inject=["PullDocsFromArray","FindIdOfApplianceOrFeature"],o.$inject=["prepareJSON","generateUUID"],angular.module("HOMDNA.common.documents",["HOMDNA.common.utils"]).factory("FindLocationOfDocument",e).factory("PullDocsFromArray",r).factory("FindIdOfApplianceOrFeature",t).factory("RemoveFromJSON",n).factory("ConvertJson",o)}(),function(){"use strict";function e(e){return{set:function(r,t){e.localStorage[r]=t},get:function(r,t){return e.localStorage[r]||t},setObject:function(r,t){e.localStorage[r]=JSON.stringify(t)},getObject:function(r){return JSON.parse(e.localStorage[r]||"{}")}}}function r(){return{getMD5:function(e){return _(e).thru(angular.toJson).thru(CryptoJS.MD5).thru(function(e){return e.toString()}).thru(btoa).value()},getVersionUpdateHeaders:function(e,r){return{"Content-MD5":this.getMD5(e),"X-Homdna-Version":(parseInt(r)+1).toString(),"X-Homdna-Modified-Version":r.toString()}}}}function t(){return function(){var e=(new Date).getTime(),r="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){var t=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===r?t:7&t|8).toString(16)});return r}}function n(e){return function(r){function t(r){var t=e.defer(),n=new FileReader;return n.onloadend=function(e){var r=SparkMD5.ArrayBuffer.hash(e.target.result);r=btoa(r.toString()),t.resolve(r)},n.readAsArrayBuffer(r),t.promise}var n=new FileReader,o=e.defer();return n.onloadend=function(){var e=n.result.split(";base64,"),u=e[1],a=e[0].split(":")[1];t(r).then(function(e){o.resolve({file:u,headers:{"Content-Type":a,"Content-MD5":e}})})},n.readAsDataURL(r),o.promise}}e.$inject=["$window"],n.$inject=["$q"],angular.module("HOMDNA.common.utils",[]).factory("$localStorage",e).factory("prepareJSON",r).factory("generateUUID",t).factory("convertFile",n)}();